// Generated by CoffeeScript 1.7.1
var createStockSocket, onmessage, sockets;

sockets = [];


/*
{
  action: '' (start, close)
  payload: '' (symbol, null)
}
 */

onmessage = function(ev) {
  var socket, _i, _len;
  console.log('received message from spawner!');
  if (ev.data.action === 'start') {
    sockets.push(createStockSocket(ev.data.payload));
  } else if (ev.data.action === 'close') {
    for (_i = 0, _len = sockets.length; _i < _len; _i++) {
      socket = sockets[_i];
      socket.close();
    }
    sockets = [];
  }
};

createStockSocket = function(symbol) {
  var socket;
  socket = new WebSocket('ws://localhost:3000/websocket');
  socket.onopen = function(ev) {
    console.log('socket connection established');
    this.send(symbol);
  };
  socket.onmessage = function(ev) {
    postMessage(ev.data);
  };
  socket.onclose = function(ev) {
    console.log('closing');
    this.close();
  };
  return socket;
};
